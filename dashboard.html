<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>D3 Dashboard</title>
  <link rel="stylesheet" href="css/dashboard.css">
  <script src="js/d3.js"></script>
  <script src="js/piechart.js"></script>
  <script src="js/annualperformance.js"></script>
  <script scr="js/linechart.js"></script>
  <script src="js/barchart.js"></script>
</head>
<body>
  <div id="pieChart"></div>
  <div id="annualPerformance"></div>
  <div id="lineChart"></div>
  <div id="barChart"></div>
  <script type="text/javascript">

    var formatAsCurrency = d3.format("$,"),
        formatAsPercentage = d3.format("%");

    function datasetSelected(teamMember, dataset){
      var data = [];
      for (x in dataset) {
        if (dataset[x].teamMember == teamMember){
          data.push(dataset[x]);
        }
      }
      return data;
    };

    drawPieChart();
    drawAnnualPerformance();
    drawBarChart();

    /* LINE CHART */

    function drawLineChart() {

      var datasetLineChart = [
          {teamMember: "Total", year: 2010, performance: 1289880},
          {teamMember: "Total", year: 2011, performance: 3890880},
          {teamMember: "Total", year: 2012, performance: 2990880},
          {teamMember: "Total", year: 2013, performance: 4039880},
          {teamMember: "Total", year: 2014, performance: 5324880}
        ];

      var w = 400;
      var h = 283;
      var p = 30;

      var svg = d3.select("#lineChart") // Finds the body in the DOM
                  .append("svg") // Adds svg element to the body
                  .attr("width", w) // with these attributes
                  .attr("height", h)
                  .style("padding", p);

      var x = d3.time.scale()
                .domain(d3.extent(datasetLineChart, function(d) {return d.year;}))
                .range([p, w-p]);

      var y = d3.scale.linear()
                .domain([0, d3.max(datasetLineChart, function(d) { return d.performance;
                })*1.1])
                .range([h - p, p]);

      var xAxis = d3.svg.axis()
                    .scale(x)
                    .tickFormat(d3.format("04d"));

      var yAxis = d3.svg.axis()
                    .scale(y)
                    .tickFormat(d3.format("s"))
                    .orient('left');

      svg.selectAll("circle")
          .data(datasetLineChart)
          .enter()
          .append("circle")
          .attr("cx", function(d,i){
            return x(d.year);
          })
          .attr("cy", function(d){
            return y(d.performance);
          })
          .attr("r", 5)
          .attr("fill", "#ccc")
          .attr("stroke", "#545")
          .attr("stroke-width","2px");

      svg.append('g')
        .attr('class', 'axis')
        .attr('transform', 'translate(0,' + (h - p) + ')')
        .call(xAxis);

      svg.append('g')
        .attr('class', 'axis')
        .attr('transform', 'translate(' + (p) + ',0)')
        .call(yAxis);

      var drawLine = d3.svg.line()
                        .x(function(d) {
                          return x(d.year);
                        })
                        .y(function(d) {
                          return y(d.performance);
                        })
                        .interpolate("cardinal");

      var path = svg.append('path')
          .attr('d', drawLine(datasetLineChart))
          .attr('stroke', '#000')
          .attr('stroke-width', 3)
          .attr('fill', 'none');

     var lineLength = path.node().getTotalLength(); // 1. get length

     path.attr("stroke-dasharray", // 2. pattern big enough to hide line
                     lineLength + ", "+lineLength)
          .attr("stroke-dashoffset",lineLength); // 3. start with gap

     path.transition()
          .duration(1000)
          .attr("stroke-dashoffset", 0); // 4. shift pattern to reveal

    };

    function updateLineChart(teamMember, color) {


    };

    drawLineChart();

  </script>
</body>
</html>
